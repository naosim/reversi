<style>
  td {
    border-width: 1px;
    border-color: #333;
    border-style: solid;
    width: 32px;
    height: 32px;
    text-align: center;
  }
  td > button {
    width: 100%;
    height: 100%;
  }
</style>

<div>
</div>
<input type="radio" name="side" value="dark" checked="checked">黒</input>
<input type="radio" name="side" value="light">白</input>
<button id="back">back</button>

<h2>操作説明</h2>
<ul>
  <li>黒、白のラジオボタンを切り替えるとプレイヤーを変更できる</li>
  <li>空の場所をクリックすると駒を置ける</li>
  <li>すでに駒のある場所をクリックすると白黒を反転できる</li>
</ul>

<script src="js/reversi.core.js"></script>
<script>
var boardLog = [board];
var getCurrentBoard = () => {
  return boardLog[boardLog.length - 1];
}
var updateBoard = (board) => boardLog.push(board)

var getCurrentSide = () => {
  let radios = document.querySelectorAll('input[type="radio"]');
  radios.filter = Array.prototype.filter;
  return radios.filter(v => v.checked).map(v => v.value)[0] == 'dark' ? Side.dark : Side.light;
}

let h = 'abcdefgh'
let v = '12345678'
var table = '<table>';
for(var y = 0; y < v.length; y++) {
  table += '<tr>';
    for(var x = 0; x < h.length; x++) {
    var s = board.look(new Pos(new Horizontal(h[x]), new Vertical(v[y])))
    table += `<td><button h="${h[x]}" v="${v[y]}" onClick="onClickSquareButton(this)"></button></td>`
  }
  table += '</tr>';
}
table += '</table>';
document.querySelector('div').innerHTML = table;

var aaa = null

var onClickSquareButton = (view) => {
  let board = getCurrentBoard()
  let side = getCurrentSide()



  let h = view.getAttribute('h');
  let v = view.getAttribute('v');
  let p = new Pos(new Horizontal(h), new Vertical(v))
  var s = board.look(p)
  
  if(s.isDefined()) {
    var disk = new Disk(s.get().getValue() == Side.dark ? Side.light : Side.dark);
    updateBoard(board.replace(p, disk))
  } else {
    updateBoard(board.place(p, new Disk(side)));
  }
  updateDisplay();
}

var updateDisplay = () => {
  let board = getCurrentBoard()
  let side = getCurrentSide()
  aaa = new PlaceLogic(board).getPlacablePositions(side)
  console.log(aaa.map(v => v.getHorizontal().getValue() + v.getVertical().getValue()))

  for(var x = 0; x < h.length; x++) {
    for(var y = 0; y < v.length; y++) {
      var _h = h[x]
      var _v = v[y]
      var s = board.look(new Pos(new Horizontal(h[x]), new Vertical(v[y])))
      var selector = `button[h="${_h}"][v="${_v}"]`
      var b = document.querySelector(selector)
      if(s.isDefined()) {
        b.innerHTML = s.get().getValue() == Side.dark ? '●' : '○'
      } else {
        b.innerHTML = ''
      }
    }
  }
}
updateDisplay();

document.querySelector('#back').addEventListener('click', () => {
  if(boardLog.length < 2) {
    return;
  }
  boardLog.pop();
  updateDisplay();
})

</script>